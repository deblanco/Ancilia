---
layout: default
---
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Ancilia Demo</title>
    <link rel="stylesheet" href="styles.css">

    <!-- ICON SDK JS is required by Ancilia -->
    <script src="https://cdn.jsdelivr.net/gh/icon-project/icon-sdk-js@latest/build/icon-sdk-js.min.js"></script>
    <script src="./Ancilia.js"></script>

    <!-- JQuery is not needed, we use it for this demo only -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script>
        // Constants
        const NETWORK = IconNetworks.YEOUIDO
        const IWIN = 'cx8901ee4f6df58bd437de0e66c9dd3385ba4c2328'
        const DESTINATION = 'hxcc8c9d91d0db660f91d8041af702d79edcb02958'
        const ICX_DECIMALS = 18

        // Instanciate Ancilia
        const ancilia = new Ancilia(NETWORK)
    </script>
</head>

<body>
    <div id="network">
        <p><b>Network Name : </b><span id="name"></span></p>
        <p><b>Network API : </b><span id="api"></span></p>
        <p><b>Network Tracker : </b><span id="tracker"></span></p>
    </div>

    <hr />

    <div id="token">
        <p><b>Token contract : </b><input class="icon-address" id="contract" type="text" />
            <button id="refresh" onClick="tokenRefresh()">Refresh</button>
        </p>
        <p><b>Token Name : </b><span id="name"></span></p>
        <p><b>Token Symbol : </b><span id="symbol"></span></p>
        <p><b>Token Decimals : </b><span id="decimals"></span></p>
    </div>

    <hr />

    <div id="account">
        <p><b>Account address : </b><span id="address"></span>
            <button id="login" onClick="onLogin()">Login</button>
        </p>

        <p><b>Account ICX Balance :</b> <span id="icxBalance"></span> ICX</p>
        <p><b>Account IWIN Balance :</b> <span id="iwinBalance"></span> IWIN</p>
        <p><b>Destination address : </b><input class="icon-address" id="destination" type="text" /></p>
        <p><b>Amount ICX : </b><input class="token-amount" id="icx-amount" type="number" />
            <button id="send-icx" onClick="sendIcx()">Send</button>
            <span id="icx-txhash"></span>
        </p>
        <p><b>Amount IWIN : </b><input class="token-amount" id="iwin-amount" type="number" />
            <button id="send-iwin" onClick="sendIwin()">Send</button>
            <span id="iwin-txhash"></span>
        </p>
    </div>

    <hr />

    <script>
        function onLoad() {
            // init network
            networkRefresh();

            // init token
            $("#token #contract").val(IWIN)
            tokenRefresh();

            // init account
            $("#account #destination").val(DESTINATION)
            $("#account #icx-amount").val(10)
            $("#account #iwin-amount").val(10)
            accountRefresh()
        }

        function onLogin() {
            if (ancilia.isLoggedIn()) {
                ancilia.logout()
                accountRefresh()
            }
            else {
                ancilia.login().then(address => {
                    accountRefresh()
                })
            }
        }

        function networkRefresh() {

            const network = {
                'api': ancilia.getAPIEndpoint(),
                'tracker': ancilia.getTrackerEndpoint(),
                'name': ancilia.getNetworkName()
            }

            $("#network #name").text(network.name)
            $("#network #api").text(network.api)
            $("#network #tracker").text(network.tracker)
        }

        function tokenRefresh() {

            const contract = $("#token #contract").val()

            const promises = [
                ancilia.irc2Decimals(contract),
                ancilia.irc2Name(contract),
                ancilia.irc2Symbol(contract)
            ]

            Promise.all(promises).then(result => {

                const [
                    decimals,
                    name,
                    symbol,
                ] = result

                $("#token #decimals").text(decimals)
                $("#token #name").text(name)
                $("#token #symbol").text(symbol)
            })
        }

        function accountRefresh() {

            const contract = $("#token #contract").val()

            if (ancilia.isLoggedIn()) {
                const address = ancilia.getLoggedInWallet()
                $("#account #address").text(address)
                $("#account #login").html('Logout')

                const promises = [
                    ancilia.icxBalance(address),
                    ancilia.irc2Balance(address, contract),
                ]

                Promise.all(promises).then(result => {

                    const [
                        accountIcx,
                        accountIwin,
                    ] = result

                    const account = {
                        'address': address,
                        'icxBalance': accountIcx,
                        'iwinBalance': accountIwin
                    }

                    $("#account #icxBalance").text(account.icxBalance)
                    $("#account #iwinBalance").text(account.iwinBalance)
                })
            } else {
                $("#account #address").text('...')
                $("#account #login").html('Login')

                $("#account #icxBalance").text('...')
                $("#account #iwinBalance").text('...')
            }
        }

        function sendIcx() {
            const address = $("#account #address").text()
            if (!ancilia.isLoggedIn()) return alert('Please login first')

            const icxAmount = $("#account #icx-amount").val()
            const loopAmount = ancilia.convertUnitToDecimals(icxAmount, ICX_DECIMALS)
            const destination = $("#account #destination").val()

            ancilia.iconexTransferIcx(destination, loopAmount).then(call => {
                const txHash = call.result
                $("#account #icx-txhash").html(`<a href='${ancilia.getTrackerEndpoint() + '/transaction/' + txHash}'>${txHash}</a>`)
            })
        }

        function sendIwin() {
            const address = $("#account #address").text()
            if (!ancilia.isLoggedIn()) return alert('Please login first')

            const contract = $("#token #contract").val()
            const iwinAmount = $("#account #iwin-amount").val()
            const loopAmount = ancilia.convertUnitToDecimals(iwinAmount, ICX_DECIMALS)
            const destination = $("#account #destination").val()

            ancilia.iconexTransferIrc2(destination, contract, loopAmount).then(call => {
                const txHash = call.result
                $("#account #iwin-txhash").html(`<a href='${ancilia.getTrackerEndpoint() + '/transaction/' + txHash}'>${txHash}</a>`)
            })
        }

        window.onload = onLoad;
    </script>
</body>